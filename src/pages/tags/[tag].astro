---
import Layout from "../../layouts/Layout.astro";
import BlogSection from "../../components/BlogSection.astro";

export async function getStaticPaths() {
	const allPosts = await Astro.glob("../../content/posts/*.mdx");

	const uniqueTags = [
		...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
	];

	return uniqueTags.map((tag) => {
		const filteredPosts = allPosts.filter((post) =>
			post.frontmatter.tags.includes(tag)
            
		);
		return {
			params: { tag },
			props: { posts: filteredPosts },
		};
	});
}

const { tag } = Astro.params;
const { posts } = Astro.props;

---

<Layout title={tag} description={tag} canonical={new URL(Astro.url.pathname, Astro.site)}>
    
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
            <h2 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">Insights</h2>
            <p class="mt-1 text-gray-600 dark:text-gray-400">Stay in the know with insights from industry experts.</p>
        </div>
        <!-- End Title -->
        
        <!-- Grid -->
        <div class="grid md:grid-cols-2 gap-10 md:max-w-[60%] mx-auto">
            {
                posts.map((post) => (
                    <BlogSection url={post.url} imagePath={post.frontmatter.imagePath} title={post.frontmatter.title} intro={post.frontmatter.intro} />
                ))
            }
            
        </div>
        
    </div>
    
</Layout>
